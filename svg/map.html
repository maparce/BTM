<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>svg test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin=""/>
  </head>
<style>
  #daMap {
        background-color: blue;
        width: 100%;
        height: 400px;
        /* position: absolute; */
    }
    #container {
        /* grid-template-columns: repeat(4, 1fr); */
        display: grid;
        width: 100%;
        height: 50%;
        /* position: absolute; */
    }
    #svgDiv{
      background-color: brown;

    }
    .incorporated{
        stroke: none;
        fill: orange;
        stroke-linecap:round;
        stroke-width:.2;
        stroke-dasharray:1,1;
        pointer-events: visible;
    }
    .unincorporated{
      stroke: none;
        fill: black;
        stroke-linecap:round;
        stroke-width:.2;
        stroke-dasharray:1,1;
        pointer-events: visible;

    }

</style>
<body>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>

    <div id="daMap"></div>
    <div id="container">
      <!-- "83.16 202.38 119.97 20.94" -->
      <div>
      <svg version="1.1" id="slider" xmlns="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" 
      xml:space="preserve" onload="makeDraggable(evt)" 
      viewBox="83.16 202.38 175 20.94">   <!-- <xml version="1.0" encoding="utf-8"?> --><style type="text/css">	.st1{opacity:0.94;fill:#0B0506;}	.st2{fill:#0B0506;}	.st3{clip-path:url(#SVGID_2_);fill:none;stroke:#0B0506;stroke-width:0.72;stroke-miterlimit:10;}  .draggable{cursor: move;}  .transparent{stroke:none; fill:none; pointer-events:visible}</style>
        <script type="text/javascript"><![CDATA[
                  var sValue = 1690; 
                  var x = undefined
                  var inc = 1;
                  var unc = 1
                  var bmousedown = 0;

                 function makeDraggable(evt) {
                   var svg = evt.target;
                   svg.addEventListener('mousedown', startDrag);
                   svg.addEventListener('mousemove', drag);
                   svg.addEventListener('mouseup', endDrag);
                   svg.addEventListener('mouseleave', endDrag);
                   svg.addEventListener('touchstart', startDrag);
                   svg.addEventListener('touchmove', drag);
                   svg.addEventListener('touchend', endDrag);
                   svg.addEventListener('touchleave', endDrag);
                   svg.addEventListener('touchcancel', endDrag);
           
                   var selectedElement, offset, transform,
                       bbox, minX, maxX, minY, maxY, confined;
           
                   var boundaryX1 = -50;
                   var boundaryX2 = 50;

                  
           
                   function getMousePosition(evt) {
                     var CTM = svg.getScreenCTM();
                     if (evt.touches) { evt = evt.touches[0]; }
                     return {
                       x: (evt.clientX - CTM.e) / CTM.a,
                       y: (evt.clientY - CTM.f) / CTM.d
                     };
                   }

                   ///function for the incorporated/un button 
                   function iBot(evt){
                     x = evt
                    if (evt.target.classList.contains('incorporated'))
                    { 
                      if (inc == 0)
                      { evt.target.style.fill = 'orange';
                        evt.target.style.stroke = 'none';
                        inc = 1
                        decadeLessThan(sValue)
                        return
                      }
                      if (inc == 1) {
                    evt.target.style.fill = 'none'
                    evt.target.style.stroke = 'orange'
                    inc = 0
                    decadeLessThan(sValue, 'incOff')
                    return }
                     
                    }
                    if (evt.target.classList.contains('unincorporated'))
                    {
                      if (unc == 0)
                      { evt.target.style.fill = 'black';
                        evt.target.style.stroke = 'none';
                        unc = 1
                        decadeLessThan(sValue)
                        return
                      }
                      if (unc == 1) {
                    evt.target.style.fill = 'none'
                    evt.target.style.stroke = 'black'
                    unc = 0
                    decadeLessThan(sValue, 'uncOff')
                    return }
                  
                    }

                   }

           
                   function startDrag(evt) {
                    
                    if (evt.target.classList.contains('clickable') & bmousedown == 0 & evt.type == "mousedown") 
                    {bmousedown = 1; iBot(evt)}
                     if (evt.target.classList.contains('draggable')) {
                       selectedElement = evt.target.parentElement;
                       offset = getMousePosition(evt);
                       clearInterval(timer)
           
                       // Make sure the first transform on the element is a translate transform
                       var transforms = selectedElement.transform.baseVal;
                       if (transforms.length === 0 || transforms.getItem(0).type !== SVGTransform.SVG_TRANSFORM_TRANSLATE) {
                         // Create an transform that translates by (0, 0)
                         var translate = svg.createSVGTransform();
                         translate.setTranslate(0, 0);
                         selectedElement.transform.baseVal.insertItemBefore(translate, 0);
                       }
           
                       // Get initial translation
                       transform = transforms.getItem(0);
                       offset.x -= transform.matrix.e;
                       offset.y -= transform.matrix.f;
                       
           
                       confined = evt.target.classList.contains('confine');
                       if (confined) {
                           bbox = selectedElement.getBBox();
                           minX = boundaryX1 - bbox.x;
                           maxX = boundaryX2 - bbox.x - bbox.width;
                       }
                     }
                   }
           
                   function drag(evt) {
                      bmousedown = 0;
                     if (selectedElement) {
                       evt.preventDefault();
           
                       var coord = getMousePosition(evt);
                       var dx = coord.x - offset.x;
                       <!-- dx = Math.round(dx) -->
                       <!-- this allows the button to stay inside the bounds or to go to the edge if you drag very fast -->
                       if(dx<-50){dx = -50} 
                       if(dx>50){dx = 50}
                       if(dx=>-50 & dx<=50){
                       transform.setTranslate(dx, 0)};
                        scrollerValue(dx);
                     }
                   }
           
                   function endDrag(evt) {
                     selectedElement = false;
                     bmousedown = 0;
                   }
                 }
               ]]> </script>
        
        <g id="elG" class="draggable">	<rect x="137" y="203.3" class="transparent draggable" width="11" height="10.4"></rect>	<path class="st1 draggable" d="M139.7,209.8c0.9-0.8,1.9-1.7,2.8-2.5c0.9,0.8,1.9,1.7,2.8,2.5c0,1.2,0,2.4,0,3.6c0,0,0,0,0,0.1c0,0,0,0,0,0   c0,0,0,0-0.1,0c0,0,0,0-0.1,0c-0.6,0-1.2,0-1.7,0c0-0.5,0-1.1,0-1.6c0,0,0-0.1,0-0.1c0,0,0,0-0.1,0c0,0-0.1,0-0.1,0   c-0.5,0-1,0-1.5,0c0,0-0.1,0-0.1,0l-0.1,0.1c0,0,0,1.6,0,1.6c-0.6,0-1.2,0-1.8,0c0,0-0.1,0-0.1,0c0,0,0,0,0,0c0,0,0,0,0-0.1   C139.7,212.1,139.7,210.9,139.7,209.8z"></path>	
                  <path class="st2 draggable" d="M137.8,209.7c0,0.3,0,0.5,0,0.8c0.1,0.1,0.2,0.2,0.2,0.3c1.5-1.7,3-3.4,4.5-5.1c1.5,1.7,3,3.4,4.5,5.1   c0.1-0.1,0.2-0.2,0.3-0.3c0-0.2,0-0.5,0-0.7c-1.6-1.8-3.2-3.6-4.8-5.4C140.9,206.1,139.4,207.9,137.8,209.7z"></path>	
                  <path class="st2 draggable" d="M139.8,204.9c0,0.6,0,1.2,0,1.8c0.4-0.4,0.8-0.7,1.2-1.1c0-0.2,0-0.5,0-0.7   C140.6,204.9,140.2,204.9,139.8,204.9z"></path>
                </g><g>	
                    <line class="st3" x1="89.2" y1="213.9" x2="196" y2="213.9"></line>
                    	<circle class="st3" cx="87.6" cy="213.9" r="1.7"></circle>	
                      <circle class="st3" cx="197.7" cy="213.9" r="1.7"></circle>
                      <text id="sliderText" x="104" y="222" font-size=".5em">Towns built before: </text>
                      <circle id="iBot" class="clickable incorporated" cx="210" cy="208" r="4" onmousdown='iBot(evt)'></circle>
                      <!-- <rect   id="iBotRect" class="clickable incorporated" x="210" y="208" width="11" height="10.4"></rect> -->

                      <circle id="uBot" class="clickable unincorporated" cx="210" cy="219" r="4"></circle>
                      <text id="iText" x="215" y="210" font-size=".4em" >Incorporated</text>
                      <text id="uText" x="215" y="221" font-size=".4em">Unincorporated</text>

                    </g></svg>
                  </div>
                    <!-- <div id="contBot">
                      <div id="incorporated">Incorporated</div>
                      <div id="incorporated">Not Incorporated</div>  

                  </div> -->
              
  </div>
    <script>
        function scrollerValue(dx){
            var decadeNum = ((Math.trunc((dx+50)/3.03) * 10) + 1690)
            document.getElementById('sliderText').innerHTML = "Towns built before: " 
            + decadeNum
            decadeLessThan(decadeNum)
            sValue = decadeNum
            // Math.trunc(dx)
            // console.log(dx)
        }
    </script>
    <script src="../data/BT.js"></script>
    <script>
      var map = L.map('daMap', { attributionControl:false }).setView([39.5, -100], 3);
      var daTile = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
	maxZoom: 19,  })
        daTile.addTo(map)
        var markerArray = []
        function addMarkers(){
            var xy = BT.features[0].geometry.coordinates
            var marker = L.marker([xy[1],xy[0]]);
            markerArray.push(marker)
            marker.addTo(map)
        }

        function removeAllMarkers(markerArray){
          markerArray.forEach(e=>{e.remove()})
        }

        function minMaxDecades() {
          var decades = []
          BT.features.forEach(e=>{decades.push(parseInt(e.properties.DecadeEst.split('-')[0]))})
          minMax = {min: Math.min.apply(null,decades), max:Math.max.apply(null,decades)}
          return minMax
        }        
        // the min 1690 and max 1960 however I will make the scroller go from 1690 to 2020
        var markerDecadeArrayINC = []
        var markerDecadeArrayUNC = []
        function decadeLessThan(decade, opt){
          if (sValue == decade)
          { 
            if (opt == "incOff")
            { removeAllMarkers(markerDecadeArrayINC)
            return}
            if (opt == "uncOff")
            { removeAllMarkers(markerDecadeArrayUNC)
            return}
          }
          removeAllMarkers(markerDecadeArrayINC)
          removeAllMarkers(markerDecadeArrayUNC)
          markerDecadeArrayINC = []
          markerDecadeArrayUNC = []
          BT.features.forEach(e=>{
            var d = parseInt(e.properties.DecadeEst.split('-')[0])
            if(d<decade){
              // console.log(e.geometry.coordinates[0])
              var marker = L.circleMarker([e.geometry.coordinates[1], e.geometry.coordinates[0]])
              if(e.properties.Incorporated == "Yes" & inc==1) {marker.options.color = 'orange'
              marker.addTo(map)
              markerDecadeArrayINC.push(marker)
                }
              
              else if (unc == 1){marker.options.color = 'black'
              marker.addTo(map)
              markerDecadeArrayUNC.push(marker)
                  }
              
              // You could add the pupup here using previous tutorials and decide the style too
              // it is called a marker but it is really a circle
    
              
              }
            })
        }

        // if -50 is 1690 and 50 is 2020
        // but we have 33 decades 
        // 1/3.03 = 
        // (Math.trunc((dx+50)/3.03) * 10) + 1690
        // 0*3.34 = 0 + 1690
        // 1*3.34 = 
        var iValue = -50;
        document.getElementById('elG').setAttributeNS(null,'transform', 'translate(-50 0)')// make tha house be on the left
        scrollerValue(iValue)
        
        let start = Date.now(); // remember start time

      let timer = setInterval(function() {
        // how much time passed from the start?
        let timePassed = Date.now() - start;

        if (timePassed >= 50*120) {
          clearInterval(timer); // finish the animation after 2 seconds
          return;
        }
        iValue = iValue + 1
        if(iValue <= 50){
        document.getElementById('elG').setAttributeNS(null,'transform', 'translate(' + iValue + ' 0)')// make tha house be on the left
        scrollerValue(iValue)}
        // draw the animation at the moment timePassed
        // draw(timePassed);

      }, 50);

// as timePassed goes from 0 to 2000
// left gets values from 0px to 400px
      
    

      </script>
</body>
</html>